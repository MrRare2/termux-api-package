#!@TERMUX_PREFIX@/bin/sh
set -e -u

SCRIPTNAME=termux-torch

show_usage() {
    echo "Usage: $SCRIPTNAME [on | off] [-i torch-id]"
    echo "Toggle LED Torch on device"
    echo "  -i torch-id  ID of the torch to use (see termux-camera-info), default: 0"
    exit 1
}

if [ "$#" -lt 1 ]; then
    echo "$SCRIPTNAME: missing arguments"
    show_usage
fi

if [ "$#" -gt 3 ]; then
    echo "$SCRIPTNAME: too many arguments"
    show_usage
fi

PARAMS=""
TORCH_ID="0"

# Parse arguments
MODE=""
while [ "$#" -gt 0 ]; do
    case "$1" in
        on)
            if [ -n "$MODE" ]; then
                echo "$SCRIPTNAME: too many arguments"
                show_usage
            fi
            MODE="on"
            PARAMS="--ez enabled true"
            ;;
        off)
            if [ -n "$MODE" ]; then
                echo "$SCRIPTNAME: too many arguments"
                show_usage
            fi
            MODE="off"
            PARAMS="--ez enabled false"
            ;;
        -i)
            shift
            if [ -z "${1:-}" ]; then
                echo "$SCRIPTNAME: missing value for -i"
                show_usage
            fi
            TORCH_ID=$1
            ;;
        -h)
            show_usage
            ;;
        *)
            echo "$SCRIPTNAME: illegal parameter: $1"
            show_usage
            ;;
    esac
    shift
done

if [ -z "$MODE" ]; then
    show_usage
fi

if [ "$TORCH_ID" != "0" ]; then
    PARAMS="$PARAMS --es torch_id $TORCH_ID"
fi

@TERMUX_PREFIX@/libexec/termux-api Torch $PARAMS
